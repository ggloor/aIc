---
title: "aIc"
output: pdf_document
---

## make a simple test function to determine if the data are compositional

the overall idea here is that compositional data have  a non-reproducible correlation structure when subset. So subset a dataset, test for correlation in the original and subset data and if different the data are compostions and need to be treated as such

secondarily test different transformations of the data to test for addition or loss of compositional behaviour

start with the selex dataset and then move on to Barton


```{r echo=F}
#' Return information on the perturbation used
#' \code{aIc} calculates the subcompositional coherence of a
#'   a dataset for a given correction if given a single datset
#' if given two datasets it calculates subcompositional 
#'   coherence between the datasets
#' basic function works for proportions
# \code{method} can be proportion, clr (RLE, TMM, RPKM, FPKM)

aIc <- function(x, method='proportion', zero='remove'){
  
  # get non-0 features only
  x <- x[apply(x, 1, min) > 0,]
  
  # make this a mini function
  # each normalization should have its own function
 
  if(method == 'clr'){
    x.1 <- apply(x, 2, function(x) log(x)/mean(log(x)))
    x.subset <- x[1:floor(nrow(x)/2),]
    x.2 <- apply(x.subset, 2, function(x) log(x)/mean(log(x)))
  }
  
  if(method == 'rle'){
    x.1 <- des.norm(x)
    x.subset <- x[1:floor(nrow(x)/2),]
    x.2 <- des.norm(x.subset)
  }
  if(method == 'proportion'){
    x.1 <- apply(x, 2, function(x) x/sum(x))
    x.subset <- x[1:floor(nrow(x)/2),]
    x.2 <- apply(x.subset, 2, function(x) x/sum(x))
  }
  c.x1 <- cor(t(x.1))
  c.x2 <- cor(t(x.2))
  plot(c.x1[1:floor(nrow(x)/2),1], c.x2[,1])
  
  cohere <- cor(c.x1[1:floor(nrow(x)/2),1], c.x2[,1])
  is.comp <- logical()
  if(cohere < 1){ is.comp = F
  } else {
    is.comp = T
  }
  return( list(cohere,is.comp))
}
```